<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      class="h-100" lang="es">

    <head>
        <title layout:title-pattern="$CONTENT_TITLE - Electrosa" th:text="${contentTitle} + ' - Electrosa'">Electrosa - PAW</title>
        <meta charset="UTF-8"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

        <!-- Favicons -->
        <link rel="apple-touch-icon" sizes="180x180" th:href="@{/static/assets/images/logo/apple-touch-icon.png}"/>
        <link rel="icon" type="image/png" sizes="32x32" th:href="@{/static/assets/images/logo/favicon-32x32.png}"/>
        <link rel="icon" type="image/png" sizes="16x16" th:href="@{/static/assets/images/logo/favicon-16x16.png}"/>

        <!-- CSS -->
        <link rel="stylesheet" th:href="@{/static/assets/css/style.css}"/>
        <link rel="stylesheet" th:href="@{/static/assets/css/custom.css}"/>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
              integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

            <!-- Google Fonts -->
            <link rel="preconnect" href="https://fonts.googleapis.com"/>
            <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
            <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet"/>

            <!-- Fragmento para head adicional -->
            <th:block layout:fragment="additional-head"></th:block>

            <!-- Añadimos Leaflet CSS y JS aquí para que estén disponibles -->
            <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
                  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
            <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

            <style>
                .shipping-form {
                    text-align: center; /* Centra el contenido horizontalmente */
                }
                #mapId {
                    margin: 0 auto; /* Centra el mapa horizontalmente */
                    display: inline-block; /* Permite que margin: 0 auto funcione */
                }
            </style>
    </head>

    <body>
        <div class="overlay" data-overlay></div>

        <!-- HEADER -->
        <header>
            <div class="header-top">
                <div class="container">
                    <ul class="header-social-container">
                        <li>
                            <a href="#" class="social-link">
                                <ion-icon name="logo-facebook"></ion-icon>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="social-link">
                                <ion-icon name="logo-twitter"></ion-icon>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="social-link">
                                <ion-icon name="logo-instagram"></ion-icon>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="social-link">
                                <ion-icon name="logo-linkedin"></ion-icon>
                            </a>
                        </li>
                    </ul>

                    <div class="header-alert-news">
                        <p th:utext="#{shipment.banner.free}"><b>Envíos gratis</b> en junio a partir de 130€</p>
                    </div>

                    <div class="header-top-actions">
                        <select name="currency">
                            <option value="eur" th:text="#{currency.euro.title}">EUR €</option>
                            <option value="usd" th:text="#{currency.dollar.title}">USD $</option>
                        </select>
                        <form action="/electrosa/lang" method="get" id="language-form">
                            <select name="lang" id="language-selector" onchange="document.getElementById('language-form').submit()">
                                <option value="es" th:text="#{lang.es}" th:selected="${#strings.equals(#locale.toString(), 'es')}">Spanish</option>
                                <option value="en" th:text="#{lang.en}" th:selected="${#strings.equals(#locale.toString(), 'en')}">English</option>
                                <option value="fr" th:text="#{lang.fr}" th:selected="${#strings.equals(#locale.toString(), 'fr')}">French</option>
                                <option value="de" th:text="#{lang.de}" th:selected="${#strings.equals(#locale.toString(), 'de')}">German</option>
                            </select>
                        </form>
                    </div>
                </div>
            </div>

            <div class="header-main">
                <div class="container">
                    <a href="/electrosa/" class="header-logo">
                        <span>ELECTROSA</span>
                    </a>

                    <div class="header-search-container">
                        <input type="search" name="search" class="search-field" th:placeholder="#{search.entireSite}" placeholder="Buscar en toda la tienda">
                            <button class="search-btn">
                                <ion-icon name="search-outline"></ion-icon>
                            </button>
                    </div>

                    <div class="header-user-actions">
                        <a href="/electrosa/cliente/cuenta" class="action-btn" th:title="#{lang.settings.title}">
                            <ion-icon name="person-outline"></ion-icon>
                        </a>
                        <a href="/electrosa/cliente/wishlist" class="action-btn"><ion-icon name="heart-outline"></ion-icon><span class="count" id="wishlist-count">0</span></a>
                        <a href="/electrosa/cliente/cesta" class="action-btn" th:title="#{lang.settings.change.title}">
                            <ion-icon name="bag-handle-outline"></ion-icon>
                            <span th:if="${session.cesta != null}" class="count">
                                [[ ${#lists.size(session.cesta?.lineas)} ]]
                            </span>
                            <span th:if="${session.cesta == null}" class="count">0</span>
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- CONTENIDO PRINCIPAL (será reemplazado) -->
        <main>
            <div class="product-container">
                <div class="container">
                    <div class="product-box">
                        <div class="product-main">
                            <h2>Dónde estamos</h2>
                            <div class="product-box d-flex gap-3 align-items-start justify-content-center">
                                <div class="product-main flex-grow-1 text-center">
                                    <div class="shipping-form p-3 border rounded-2" style="width: 512px;">
                                        <div id="mapId" style="width: 100%; height: 512px;"></div>
                                    </div>
                                </div>

                                <!-- Bootstrap -->
                                <article class="mt-4">
                                    <div class="accordion" id="accordionAlmacenes">
                                        <div th:each="almacen, iterStat : ${almacenes}" class="accordion-item">
                                            <h2 class="accordion-header" th:id="'heading' + ${iterStat.index}">
                                                <button class="accordion-button" type="button" th:data-bs-toggle="collapse"
                                                        th:data-bs-target="'#collapse' + ${iterStat.index}" aria-expanded="true"
                                                        th:aria-controls="'collapse' + ${iterStat.index}">
                                                    <span th:text="'Almacén Zona ' + ${almacen.zona}"></span>
                                                </button>
                                            </h2>
                                            <div th:id="'collapse' + ${iterStat.index}" class="accordion-collapse collapse"
                                                 th:classappend="${iterStat.index == 0} ? 'show' : ''" data-bs-parent="#accordionAlmacenes">
                                                <div class="accordion-body">
                                                    <p th:text="${almacen.calle}"></p>
                                                    <p th:text="${almacen.ciudad}"></p>
                                                    <p th:text="${almacen.cp} + ', ' + ${almacen.provincia}"></p>
                                                    <strong>Coordenadas:</strong> <span th:text="'[' + ${almacen.coordX} + ', ' + ${almacen.coordY} + ']'"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </article>



                                <!-- SIDEBAR DERECHO -->
                                <div class="sidebar right-sidebar flex-shrink-0" style="max-width: 320px;">
                                    <div class="sidebar-category p-3 border rounded-2">
                                        <h4>Más información:</h4>
                                        <ul class="info-list list-unstyled">
                                            <li><a href="#" style="color: var(--salmon-pink);">Contacto</a></li>
                                            <li><a href="#" style="color: var(--salmon-pink);">Nuestro equipo</a></li>
                                            <li><a href="#" style="color: var(--salmon-pink);">Mapa del sitio</a></li>
                                            <li><a id="enlaceDonde" href="#" style="color: var(--salmon-pink);">Dónde estoy</a></li>
                                        </ul>
                                    </div>
                                </div>




                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- FOOTER -->
        <footer>
            <div class="footer-nav">
                <div class="container">
                    <ul class="footer-nav-list">
                        <li class="footer-nav-item">
                            <h2 class="nav-title">Sobre Electrosa</h2>
                        </li>
                        <li class="footer-nav-item">
                            <a href="/electrosa/info/almacenes" class="footer-nav-link">Dónde estamos</a>
                        </li>
                        <li class="footer-nav-item">
                            <a href="/electrosa/about/team" class="footer-nav-link">Nuestro equipo</a>
                        </li>
                        <li class="footer-nav-item">
                            <a href="#" class="footer-nav-link">Trabaja con nosotros</a>
                        </li>
                    </ul>

                    <ul class="footer-nav-list">
                        <li class="footer-nav-item">
                            <h2 class="nav-title">Información</h2>
                        </li>
                        <li class="footer-nav-item">
                            <a href="#" class="footer-nav-link">Seguir pedido</a>
                        </li>
                        <li class="footer-nav-item">
                            <a href="/electrosa/about/delivery" class="footer-nav-link">Plazos de entrega</a>
                        </li>
                        <li class="footer-nav-item">
                            <a href="/electrosa/marcas" class="footer-nav-link">Marcas</a>
                        </li>
                        <li class="footer-nav-item">
                            <a href="#" class="footer-nav-link">Formas de pago</a>
                        </li>
                    </ul>

                    <ul class="footer-nav-list">
                        <li class="footer-nav-item">
                            <h2 class="nav-title">Servicios</h2>
                        </li>
                        <li class="footer-nav-item">
                            <a href="#" class="footer-nav-link">Tarjeta PAW</a>
                        </li>
                        <li class="footer-nav-item">
                            <a href="#" class="footer-nav-link">Financiación de compras</a>
                        </li>
                        <li class="footer-nav-item">
                            <a href="#" class="footer-nav-link">Devoluciones</a>
                        </li>
                        <li class="footer-nav-item">
                            <a href="#" class="footer-nav-link">Mapa del sitio</a>
                        </li>
                    </ul>

                    <ul class="footer-nav-list">
                        <li class="footer-nav-item">
                            <h2 class="nav-title">Extras</h2>
                        </li>
                        <li class="footer-nav-item">
                            <a href="#" class="footer-nav-link">Blog</a>
                        </li>
                        <li class="footer-nav-item">
                            <a href="#" class="footer-nav-link">Etiquetado energético</a>
                        </li>
                        <li class="footer-nav-item">
                            <a href="#" class="footer-nav-link">Política de cookies</a>
                        </li>
                        <li class="footer-nav-item">
                            <a href="#" class="footer-nav-link">Política de privacidad</a>
                        </li>
                    </ul>

                    <ul class="footer-nav-list">
                        <li class="footer-nav-item">
                            <h2 class="nav-title">Contacto</h2>
                        </li>
                        <li class="footer-nav-item flex">
                            <div class="icon-box">
                                <ion-icon name="location-outline"></ion-icon>
                            </div>
                            <address class="content">
                                <b>Facultad de Ciencia y Tecnología</b>
                                <br/>
                                Edificio CCT<br/>
                                C/ Madre de Dios, 53<br/>
                                26006 Logroño (La Rioja)
                            </address>
                        </li>
                        <li class="footer-nav-item flex">
                            <div class="icon-box">
                                <ion-icon name="call-outline"></ion-icon>
                            </div>
                            <a href="tel:+34 941001002" class="footer-nav-link">941 001 002</a>
                        </li>
                    </ul>

                    <ul class="footer-nav-list">
                        <li class="footer-nav-item">
                            <h2 class="nav-title">Redes sociales</h2>
                        </li>
                        <li>
                            <ul class="social-link">
                                <li class="footer-nav-item">
                                    <a href="#" class="footer-nav-link">
                                        <ion-icon name="logo-facebook"></ion-icon>
                                    </a>
                                </li>
                                <li class="footer-nav-item">
                                    <a href="#" class="footer-nav-link">
                                        <ion-icon name="logo-twitter"></ion-icon>
                                    </a>
                                </li>
                                <li class="footer-nav-item">
                                    <a href="#" class="footer-nav-link">
                                        <ion-icon name="logo-linkedin"></ion-icon>
                                    </a>
                                </li>
                                <li class="footer-nav-item">
                                    <a href="#" class="footer-nav-link">
                                        <ion-icon name="logo-instagram"></ion-icon>
                                    </a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="footer-bottom">
                <div class="container">
                    <p class="copyright">
                        Programación de aplicaciones web - Universidad de La Rioja
                        <br/>
                        &#x2661;
                        Crafted with love
                    </p>
                </div>
            </div>
        </footer>

        <!-- SCRIPTS -->
        <script th:inline="javascript">
            /*<![CDATA[*/
            window.addEventListener("load", function () {
                var map;
                var almacenes = /*[[${almacenes}]]*/ [];
                var centroAlmacen = almacenes.length > 0 ? [almacenes[0].coordX, almacenes[0].coordY] : [40.4169473, -3.7035285];
                var zoomLevel = 6;

                map = L.map('mapId', {
                    center: centroAlmacen,
                    zoom: zoomLevel
                });

                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(map);

                almacenes.forEach(function (almacen) {
                    L.marker([almacen.coordX, almacen.coordY])
                            .bindPopup(almacen.calle + ", " + almacen.cp)
                            .addTo(map);
                });

                // Evento para el enlace "Dónde estoy"
                document.getElementById('enlaceDonde').addEventListener('click', function (e) {
                    e.preventDefault();
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(showPosition, showError);
                    } else {
                        console.error("Geolocalización no soportada.");
                    }
                });

                function showPosition(position) {
                    var userLocation = [position.coords.latitude, position.coords.longitude];
                    L.circle(userLocation, {
                        color: '#5C7E74',
                        fillColor: '#5C7E74',
                        fillOpacity: 0.5,
                        radius: 20000
                    }).addTo(map)
                            .bindPopup("Tu ubicación")
                            .openPopup();
                    map.setView(userLocation, 6);
                }

                function showError(error) {
                    console.error("Error en geolocalización: " + error.message);
                }
            });
            /*]]>*/
        </script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
        <script th:src="@{/static/assets/js/practica8_language.js}"></script>
        <script th:src="@{/static/assets/js/script.js}"></script>
        <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
        <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    </body>
</html>